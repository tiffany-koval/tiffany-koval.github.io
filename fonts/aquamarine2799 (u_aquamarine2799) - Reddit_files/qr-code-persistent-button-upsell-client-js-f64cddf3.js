import{a as e,_ as t,n as o,e as a,f8 as i,b4 as r,da as s,b7 as n,db as h,f9 as d,dc as c,b9 as l,ba as p,dd as u,o as m,bc as v,b3 as f}from"./shell-091aa980.js";import{i as y,s as b,x as g}from"./icon-bd54b9fa.js";import"./custom-event-dispatch-wrapper-07e36208.js";import{c as w}from"./contains-1042b204.js";import{I as k}from"./interaction-controller-daa20b2e.js";import{P as C}from"./rpl-tooltip-b3d8c47e.js";import"./uxts-tracker-cbdf9413.js";let R=class extends b{constructor(){super(...arguments),this.showAfterSec=0,this.show=async()=>{const e=this.getCoachmark();if(!e)return;e.show();const t=1e3*(this.showForSec||0);t&&(this.closeTimeoutId=setTimeout(this.hide,t))},this.hide=()=>{this.getCoachmark()?.hide()}}connectedCallback(){super.connectedCallback(),requestAnimationFrame((()=>{this.getCoachmark()?.addEventListener("dismiss-coachmark",this.hide)}));const e=1e3*(this.showAfterSec||0);this.showTimeoutId=setTimeout(this.show,e)}disconnectedCallback(){super.disconnectedCallback(),clearTimeout(this.showTimeoutId),clearTimeout(this.closeTimeoutId),this.getCoachmark()?.removeEventListener("dismiss-coachmark",this.hide)}getCoachmark(){return document.querySelector(`rpl-hovercard#${this.coachmarkId}, rpl-tooltip#${this.coachmarkId}`)}createRenderRoot(){return this}};R.styles=[y`:host{display:contents}`,e],t([o({type:String,attribute:"coachmark-id"})],R.prototype,"coachmarkId",void 0),t([o({type:Number,attribute:"show-after-sec"})],R.prototype,"showAfterSec",void 0),t([o({type:Number,attribute:"show-for-sec"})],R.prototype,"showForSec",void 0),R=t([a("shreddit-coachmark-trigger")],R);const E=new WeakSet;class x extends s{constructor(){super(...arguments),this.contentSlotRef=n(),this.defaultSlotRef=n(),this.hovercardBodyRef=n(),this.popperRef=n(),this.anchorElement=null,this.interactionController=new k(this,{isInteractedWith:e=>e.open,hoverDelayStart:e=>h(getComputedStyle(e).getPropertyValue("--show-delay")),hoverDelayEnd:e=>h(getComputedStyle(e).getPropertyValue("--hide-delay")),delayOpenOnFocus:!0}),this.placement=C.Top,this.disabled=!1,this.distance=4,this.open=!1,this.skidding=0,this.trigger="hover focus",this.hoist=!1,this.noAnimate=!1,this.arrow=!1,this.eventUsedMap=new WeakMap,this.handleDocumentKeyDown=e=>{"Escape"===e.key&&(e.stopPropagation(),this.hide(),this.defaultSlotRef.value&&this.focusFirstTabbableElement(this.defaultSlotRef.value))},this.handleDocumentClick=e=>{if(!(e.target instanceof HTMLElement)||this.hidden)return;this.eventUsedMap.has(e)||w(this,e.target)||this.hide()}}disconnectedCallback(){document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("click",this.handleDocumentClick)}willUpdate(e){e.has("open")&&this.hasUpdated&&this.handleOpenChange(),e.has("disabled")&&this.handleDisabledChange(),(e.has("content")||e.has("distance")||e.has("hoist")||e.has("placement")||e.has("skidding"))&&this.handleOptionsChange()}firstUpdated(){this.hovercardBodyRef.value&&(this.hovercardBodyRef.value.hidden=!0),this.open&&this.popperRef.value&&this.handleOpenChange()}startInteraction(e,t){this.eventUsedMap.has(e)||(this.interactionController.interactionTrigger=t,this.eventUsedMap.set(e,!0),this.show())}finishInteraction(e){this.eventUsedMap.set(e,!0),this.hide()}focusFirstTabbableElement(e){const t=d(e)[0];t&&"focus"in t&&"function"==typeof t.focus&&(t.addEventListener("focusin",(e=>{this.eventUsedMap.set(e,!0)}),{once:!0,capture:!0}),t.focus({preventScroll:!0}))}async handleOpenChange(){if(!this.disabled&&this.contentSlotRef.value&&this.hovercardBodyRef.value&&this.popperRef.value)if(this.open){this.emitter.dispatch("show");const e=(async(e,t="faceplate-partial")=>{const o=t.toLowerCase(),a=i((e=>e.tagName.toLowerCase()===o&&(e=>"loading"in e&&"load"in e&&"function"==typeof e?.load)(e)),e);return(await Promise.all(a.map((async e=>!e||E.has(e)||"programmatic"!==e.loading?Promise.resolve(!1):(E.add(e),e.load().then((()=>!0))))))).filter(Boolean).length>0})(this.contentSlotRef.value);document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("click",this.handleDocumentClick),await c(this.hovercardBodyRef.value),this.hovercardBodyRef.value.hidden=!1,this.popperRef.value.active=!0,this.updateAnchorElementAria();const{keyframes:t,options:o}=l(this,"hovercard.show");await p(this.popperRef.value.popup,t,o),this.popperRef.value.reposition(),await e,"focus"===this.interactionController.interactionTrigger&&this.focusFirstTabbableElement(this.hovercardBodyRef.value),this.emitter.dispatch("after-show")}else{this.emitter.dispatch("hide"),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("click",this.handleDocumentClick),await c(this.hovercardBodyRef.value);const{keyframes:e,options:t}=l(this,"hovercard.hide");await p(this.popperRef.value.popup,e,t),this.popperRef.value.active=!1,this.hovercardBodyRef.value.hidden=!0,this.updateAnchorElementAria(),this.emitter.dispatch("after-hide")}}async handleOptionsChange(){this.hasUpdated&&this.popperRef.value&&(await this.updateComplete,this.popperRef.value.reposition())}handleAnchorSlotChange(){this.defaultSlotRef.value&&(this.anchorElement=i((e=>e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement||["button","link","menuitem","tab","checkbox","combobox","gridcell","application","treeitem"].includes(e?.getAttribute("role")??"")),this.defaultSlotRef.value)[0]??null,this.updateAnchorElementAria())}updateAnchorElementAria(){this.anchorElement?.setAttribute("aria-haspopup","dialog"),this.anchorElement?.setAttribute("aria-expanded",this.open?"true":"false")}handleDisabledChange(){this.disabled&&this.open&&this.hide()}async show(){if(!this.open)return this.open=!0,u(this,this.emitter.eventId("after-show"))}async hide(){if(this.open)return this.open=!1,u(this,this.emitter.eventId("after-hide"))}render(){return g` <rpl-popper part="popper" exportparts="
          popup:popper--popup,
          arrow:popper--arrow
        " class="${m({hovercard:!0,"hovercard--open":this.open})}" placement="${this.placement}" distance="${this.distance}" skidding="${this.skidding}" strategy="${this.hoist?"fixed":"absolute"}" flip shift safe-area ?arrow="${this.arrow}" @mouseenter="${this.interactionController.handleMouseEnter}" @mouseleave="${this.interactionController.handleMouseLeave}" @mousedown="${this.interactionController.handleMouseDown}" @mouseup="${this.interactionController.handleMouseUp}" @focusin="${this.interactionController.handleFocus}" @focusout="${this.interactionController.handleBlur}" @click="${e=>this.eventUsedMap.set(e,!0)}" ${v(this.popperRef)}> <slot slot="anchor" aria-describedby="hovercard" @click="${this.interactionController.handleClick}" ${v(this.defaultSlotRef)} @slotchange="${this.handleAnchorSlotChange}"></slot> <div part="body" id="hovercard" class="hovercard-body" role="dialog" aria-live="${this.open?"polite":"off"}" ${v(this.hovercardBodyRef)}> <slot name="content" ${v(this.contentSlotRef)}></slot> </div> </rpl-popper> `}}t([o()],x.prototype,"placement",void 0),t([o({type:Boolean,reflect:!0})],x.prototype,"disabled",void 0),t([o({type:Number})],x.prototype,"distance",void 0),t([o({type:Boolean,reflect:!0})],x.prototype,"open",void 0),t([o({type:Number})],x.prototype,"skidding",void 0),t([o()],x.prototype,"trigger",void 0),t([o({type:Boolean})],x.prototype,"hoist",void 0),t([o({type:Boolean,attribute:"no-animate"})],x.prototype,"noAnimate",void 0),t([o({type:Boolean})],x.prototype,"arrow",void 0),r("hovercard.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:150,easing:"ease"}}),r("hovercard.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:150,easing:"ease"}});var S=y`${f}:host{--max-width:20rem;--hide-delay:500ms;--show-delay:750ms;--rpl-hovercard-background-color:var(--color-neutral-background);--rpl-hovercard-color:var(--color-neutral-content-strong);display:contents}.hovercard{--arrow-color:var(--rpl-hovercard-background-color)}.hovercard::part(popup){z-index:var(--rpl-z-index-hovercard,var(--faceplate-hovercard-z-index,1))}.hovercard[placement^=top]::part(popup){transform-origin:bottom}.hovercard[placement^=bottom]::part(popup){transform-origin:top}.hovercard[placement^=left]::part(popup){transform-origin:right}.hovercard[placement^=right]::part(popup){transform-origin:left}.hovercard-body{display:flex;flex-direction:column;width:fit-content;justify-content:flex-start;align-items:flex-start;box-sizing:border-box;border-radius:1rem;box-shadow:var(--elevation-md);z-index:var(--rpl-hovercard-z-index,var(--faceplate-tooltip-z-index,1));font:var(--font-12-16-semibold);background-color:var(--rpl-hovercard-background-color);color:var(--rpl-hovercard-color);padding:8px}`;let $=class extends x{};$.styles=S,$=t([a("rpl-hovercard")],$);
//# sourceMappingURL=qr-code-persistent-button-upsell-client-js-f64cddf3.js.map

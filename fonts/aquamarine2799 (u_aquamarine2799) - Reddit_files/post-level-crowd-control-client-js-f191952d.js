import{W as t,E as e,aB as s,gT as a,J as l,k as i,g as o,aD as d,aE as r,l as n,b as u,c,a as h,_ as p,n as m,t as v,w as b,e as f}from"./shell-091aa980.js";import{x as w,M as S,I as y,s as C}from"./icon-bd54b9fa.js";import{a as g}from"./settingsLabels-850aff28.js";import{O as x}from"./custom-event-8a5c1c61.js";import"./faceplate-modal-0f0c31b7.js";let L=class extends(t(C)){constructor(){super(...arguments),this.isSafetySettingsShredditMigrationEnabled=!1,this.isLoading=!0,this.isSubmittable=!1,this.postId="",this._windowEvents=new e(this,(()=>window)),this.handleOpenModalEvent=this._windowEvents.define(x,(async t=>{this.isSubmittable=!1,this.isLoading=!0,this.showModal(),await this.activateFormContentFeature(t.detail.postId),this.postId=t.detail.postId,this.isLoading=!1}))}get oldPostLevel(){return this.querySelector('[name="old-post-level"]')?.value}get oldIsFilterEnabled(){return"true"===this.querySelector('[name="old-is-filter-enabled"]')?.value}activateFormContentFeature(t){return s({name:a,routeParams:{postId:t},renderMode:l.Contents})}showModal(){this.modal?.showModal()}closeModal(){this.modal?.close()}buildAlert(t){const e=t?i.success:i.error;return this.dispatchEvent(o("faceplate-alert",{level:e,message:g(t)}))}async onSave(){const t=this.querySelector('[name="post-level"][checked]'),e=this.querySelector('[name="is-filter-enabled"]');t?.value&&e?(this.submitRequest(t.value,null!=e.value),this.emitV2Event(t.value,null!=e.value)):(this.buildAlert(!1),this.isSubmittable=!0)}async submitRequest(t,e){try{this.isSubmittable=!1;const s=await this.invokeGQL(t,e);this.inspectResp(s)}catch(t){this.buildAlert(!1),this.isSubmittable=!0}}invokeGQL(t,e){return d({operation:r.UpdatePostLevelCrowdControlSettings,variables:{id:this.postId,level:t,filterIsEnabled:e,shouldIncludeUpdatePostCrowdControlFilter:e!==this.oldIsFilterEnabled,shouldIncludeUpdatePostCrowdControlLevel:t!==this.oldPostLevel}})}inspectResp(t){let e=!1;"updatePostCrowdControlFilter"in t.data&&"updatePostCrowdControlLevel"in t.data?t.data.updatePostCrowdControlFilter?.ok&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0):"updatePostCrowdControlFilter"in t.data?t.data.updatePostCrowdControlFilter?.ok&&(e=!0):"updatePostCrowdControlLevel"in t.data&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0),e?(this.buildAlert(!0),this.closeModal()):(this.buildAlert(!1),this.isSubmittable=!0)}isContentLoading(){return this.isLoading}emitV2Event(t,e){const s=this.querySelector('[name="subreddit-id"]'),a=this.querySelector('[name="subreddit-name"]'),l={id:s?.value||"",name:a?.value||""},i=this.querySelector('[name="author-id"]'),o={id:this.postId,author:{id:i?.value||""}};this.buildAndTrack("crowd_control_individual_post",o,l,{value:t,old_value:`${this.oldPostLevel}`}),this.buildAndTrack("crowd_control_individual_post_filter",o,l,{value:`${e}`,old_value:`${this.oldIsFilterEnabled}`})}buildAndTrack(t,e,s,a){const l=n({source:"post_mod_action_menu",action:"save",noun:t},{post:e,subreddit:s,setting:a});this.trackEvent(l)}handleInput(){this.isSubmittable=!0}render(){return w` <faceplate-modal inFocusTrap class="max-w-md w-full"> <div slot="title"> ${this.isSafetySettingsShredditMigrationEnabled?"Adjust post crowd control":"Adjust Crowd Control"} </div> <div slot="closeButton"> ${u({appearance:"secondary",leadingIcon:S({size:y.Small}),size:c.Small,attributes:{type:"button",onclick:this.closeModal}})} </div> ${this.isLoading?w`<div class="w-full"> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-2/3 h-lg"></faceplate-shimmer> </div>`:w`<slot @input="${this.handleInput}"></slot>`} <div slot="primaryButton"> ${u({children:"Save",appearance:"primary",attributes:{type:"submit",onclick:this.onSave,disabled:!this.isSubmittable}})} </div> <div slot="secondaryButton"> ${u({children:"Cancel",appearance:"plain",attributes:{type:"button",onclick:this.closeModal}})} </div> </faceplate-modal> `}};L.styles=[h],p([m({type:Boolean,attribute:"shreddit-safety-settings-enabled"})],L.prototype,"isSafetySettingsShredditMigrationEnabled",void 0),p([v()],L.prototype,"isLoading",void 0),p([v()],L.prototype,"isSubmittable",void 0),p([v()],L.prototype,"postId",void 0),p([b("faceplate-modal")],L.prototype,"modal",void 0),L=p([f("post-level-crowd-control-modal")],L);
//# sourceMappingURL=post-level-crowd-control-client-js-f191952d.js.map
